



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Programming notes, snipets and examples in one place.">
      
      
      
        <meta name="author" content="José Aniceto">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.2">
    
    
      
        <title>Deploy a Django app in an Ubuntu VPS (DigitalOcean) - Programming Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.ba0fd1a6.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#deploy-a-django-app-in-an-ubuntu-vps-digitalocean" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Programming Notes" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Programming Notes
              </span>
              <span class="md-header-nav__topic">
                Deploy a Django app in an Ubuntu VPS (DigitalOcean)
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Programming Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Programming Notes" class="md-nav__link">
      Programming Notes
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      General
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        General
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../batch-script/" title="Create a Windows batch script" class="md-nav__link">
      Create a Windows batch script
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../crontab/" title="Linux Crontab" class="md-nav__link">
      Linux Crontab
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Deploy a Django app in an Ubuntu VPS (DigitalOcean)
      </label>
    
    <a href="./" title="Deploy a Django app in an Ubuntu VPS (DigitalOcean)" class="md-nav__link md-nav__link--active">
      Deploy a Django app in an Ubuntu VPS (DigitalOcean)
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-initial-server-setup" title="1) Initial Server Setup" class="md-nav__link">
    1) Initial Server Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-install-the-packages-from-the-ubuntu-repositories" title="2) Install the Packages from the Ubuntu Repositories" class="md-nav__link">
    2) Install the Packages from the Ubuntu Repositories
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-install-the-database" title="3) Install the Database" class="md-nav__link">
    3) Install the Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-postgres" title="For Postgres:" class="md-nav__link">
    For Postgres:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-mysql" title="For MySQL" class="md-nav__link">
    For MySQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-create-a-python-virtual-environment" title="4) Create a Python Virtual Environment" class="md-nav__link">
    4) Create a Python Virtual Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-create-django-project" title="5) Create Django project" class="md-nav__link">
    5) Create Django project
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connect-your-django-app-to-mysql" title="Connect your Django app to MySQL" class="md-nav__link">
    Connect your Django app to MySQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-setting-up-gunicorns-ability-to-serve-the-project" title="6) Setting up Gunicorn's ability to serve the project" class="md-nav__link">
    6) Setting up Gunicorn's ability to serve the project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-configure-nginx-to-proxy-pass-to-gunicorn" title="7) Configure Nginx to Proxy Pass to Gunicorn" class="md-nav__link">
    7) Configure Nginx to Proxy Pass to Gunicorn
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-troubleshooting" title="8) Troubleshooting" class="md-nav__link">
    8) Troubleshooting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-environments/" title="Dev environments" class="md-nav__link">
      Dev environments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../git/" title="Git" class="md-nav__link">
      Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../keep-ssh-running/" title="Keep ssh running" class="md-nav__link">
      Keep ssh running
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../os-env-vars/" title="Os env vars" class="md-nav__link">
      Os env vars
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../server-setup/" title="Server setup" class="md-nav__link">
      Server setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ubuntu-vps/" title="Ubuntu vps" class="md-nav__link">
      Ubuntu vps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../web-dev-resources/" title="Web dev resources" class="md-nav__link">
      Web dev resources
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Html css
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Html css
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../html-css/css-selectors/" title="Css selectors" class="md-nav__link">
      Css selectors
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Javascript
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Javascript
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../javascript/DataTables/" title="DataTables" class="md-nav__link">
      DataTables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../javascript/cache-data/" title="Cache data" class="md-nav__link">
      Cache data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Python
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Python
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/args-kwargs/" title="Args kwargs" class="md-nav__link">
      Args kwargs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/beautifulsoup4/" title="Beautifulsoup4" class="md-nav__link">
      Beautifulsoup4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/builtin-functions/" title="Builtin functions" class="md-nav__link">
      Builtin functions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/classes/" title="Classes" class="md-nav__link">
      Classes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/csv/" title="Csv" class="md-nav__link">
      Csv
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/django/" title="Django" class="md-nav__link">
      Django
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/email/" title="Email" class="md-nav__link">
      Email
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/flask/" title="Flask" class="md-nav__link">
      Flask
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/hosting/" title="Hosting" class="md-nav__link">
      Hosting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/image-manipulation/" title="Image manipulation" class="md-nav__link">
      Image manipulation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/imports/" title="Imports" class="md-nav__link">
      Imports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/magic-methods/" title="Magic methods" class="md-nav__link">
      Magic methods
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/matlab/" title="Matlab" class="md-nav__link">
      Matlab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/mysql/" title="Mysql" class="md-nav__link">
      Mysql
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/progress-bar/" title="Progress bar" class="md-nav__link">
      Progress bar
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/slice-notation/" title="Slice notation" class="md-nav__link">
      Slice notation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/snippets/" title="Snippets" class="md-nav__link">
      Snippets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/store-dicts/" title="Store dicts" class="md-nav__link">
      Store dicts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/stravalib/" title="Stravalib" class="md-nav__link">
      Stravalib
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/string-formatting/" title="String formatting" class="md-nav__link">
      String formatting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/virtual-environments/" title="Virtual environments" class="md-nav__link">
      Virtual environments
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-initial-server-setup" title="1) Initial Server Setup" class="md-nav__link">
    1) Initial Server Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-install-the-packages-from-the-ubuntu-repositories" title="2) Install the Packages from the Ubuntu Repositories" class="md-nav__link">
    2) Install the Packages from the Ubuntu Repositories
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-install-the-database" title="3) Install the Database" class="md-nav__link">
    3) Install the Database
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#for-postgres" title="For Postgres:" class="md-nav__link">
    For Postgres:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#for-mysql" title="For MySQL" class="md-nav__link">
    For MySQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-create-a-python-virtual-environment" title="4) Create a Python Virtual Environment" class="md-nav__link">
    4) Create a Python Virtual Environment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-create-django-project" title="5) Create Django project" class="md-nav__link">
    5) Create Django project
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connect-your-django-app-to-mysql" title="Connect your Django app to MySQL" class="md-nav__link">
    Connect your Django app to MySQL
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-setting-up-gunicorns-ability-to-serve-the-project" title="6) Setting up Gunicorn's ability to serve the project" class="md-nav__link">
    6) Setting up Gunicorn's ability to serve the project
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-configure-nginx-to-proxy-pass-to-gunicorn" title="7) Configure Nginx to Proxy Pass to Gunicorn" class="md-nav__link">
    7) Configure Nginx to Proxy Pass to Gunicorn
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#8-troubleshooting" title="8) Troubleshooting" class="md-nav__link">
    8) Troubleshooting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" title="References" class="md-nav__link">
    References
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="deploy-a-django-app-in-an-ubuntu-vps-digitalocean">Deploy a Django app in an Ubuntu VPS (DigitalOcean)</h1>
<p>This guide will demonstrate how to install and configure some components on Ubuntu 16.04 to support and serve Django applications. We will be setting up a PostgreSQL database and configure the Gunicorn application server to interface with our applications. We will then set up Nginx to reverse proxy to Gunicorn, giving us access to its security and performance features to serve our apps.</p>
<h2 id="1-initial-server-setup">1) Initial Server Setup</h2>
<p>Perform the initial server setup as detailed <a href="../server-setup/">here</a>.</p>
<h2 id="2-install-the-packages-from-the-ubuntu-repositories">2) Install the Packages from the Ubuntu Repositories</h2>
<p>We need to update the local apt package index and then download and install the packages. The packages we install depend on which version of Python your project will use.</p>
<p>If you are using Django with Python 3, type:</p>
<pre><code>$ sudo apt-get update
$ sudo apt-get install python3-pip python3-dev libpq-dev nginx
</code></pre>

<p>This will install pip, the Python development files needed to build Gunicorn later and the Nginx web server.</p>
<h2 id="3-install-the-database">3) Install the Database</h2>
<p>Install the database system and the libraries needed to interact with it.</p>
<h4 id="for-postgres">For Postgres:</h4>
<pre><code>$ sudo apt-get install postgresql postgresql-contrib`
</code></pre>

<h4 id="for-mysql">For MySQL</h4>
<pre><code>$ sudo apt-get install libmysqlclient-dev
$ sudo apt-get install mysql-server mysql-client
</code></pre>

<p>Now let's create the Database and User but first verify that the MySQL service is running:</p>
<pre><code>$ systemctl status mysql.service
</code></pre>

<p>If the output is negative you can run <code>sudo systemctl start mysql</code> to get <code>mysql.service</code> started again. Now you can log in with your MySQL credentials using the following command. Where <code>-u</code> is the flag for declaring your username and <code>-p</code> is the flag that tells MySQL that this user requires a password:</p>
<pre><code>$ sudo mysql -u db_user -p
</code></pre>

<pre><code class="mysql">mysql&gt; SHOW DATABASES;
mysql&gt; CREATE DATABASE project_db;
mysql&gt; SHOW DATABASES;
</code></pre>

<p>Whenever you'd like to exit MySQL server, press CTRL + D.</p>
<h2 id="4-create-a-python-virtual-environment">4) Create a Python Virtual Environment</h2>
<pre><code>$ sudo -H pip3 install --upgrade pip
$ sudo -H pip3 install virtualenv
</code></pre>

<pre><code>$ mkdir ~/myproject
$ cd ~/myproject
$ virtualenv venv
$ source venv/bin/activate
</code></pre>

<p>Note: Regardless of which version of Python you are using, when the virtual environment is activated, you should use the pip command (not pip3).</p>
<p>Install the <code>mysqlclient</code> library:</p>
<pre><code>$ pip install mysqlclient
</code></pre>

<p>With your virtual environment active, install Django and Gunicorn:</p>
<pre><code>$ pip install django gunicorn
</code></pre>

<h2 id="5-create-django-project">5) Create Django project</h2>
<p>Since we already have a project directory, we will tell Django to install the files here. It will create a second level directory with the actual code, which is normal, and place a management script in this directory. The key to this is that we are defining the directory explicitly instead of allowing Django to make decisions relative to our current directory:</p>
<pre><code>$ django-admin startproject myproject ~/myproject
</code></pre>

<p>At this point, your project directory (~/myproject in our case) should have the following content:</p>
<pre><code>~/myproject/manage.py: A Django project management script.
~/myproject/myproject/: The Django project package. This should contain the __init__.py, settings.py, urls.py, and wsgi.py files.
~/myproject/myprojectenv/: The virtual environment directory we created earlier.
</code></pre>

<p>Go to the end of the <code>settings.py</code> file and add <code>STATIC_ROOT</code> as shown below:</p>
<pre><code class="python"># Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/2.0/howto/static-files/

STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'static')
</code></pre>

<p>Add your server’s IP address between the square brackets and single quotes to the <code>ALLOWED_HOSTS</code>:</p>
<pre><code class="python"># The simplest case: just add the domain name(s) and IP addresses of your Django server
# ALLOWED_HOSTS = [ 'example.com', '203.0.113.5']
# To respond to 'example.com' and any subdomains, start the domain with a dot
# ALLOWED_HOSTS = ['.example.com', '203.0.113.5']
ALLOWED_HOSTS = ['your_server_domain_or_IP', 'second_domain_or_IP', . . .]
</code></pre>

<p>Migrate the initial database schema to our database using the management script:</p>
<pre><code>(venv) $ python ~/myproject/manage.py makemigrations
(venv) $ python ~/myproject/manage.py migrate
</code></pre>

<p>Create an administrative user for the project by typing:</p>
<pre><code>(venv) $ ~/myproject/manage.py createsuperuser
</code></pre>

<p>We can collect all of the static content into the directory location we configured by typing:</p>
<pre><code>(venv) $ ~/myproject/manage.py collectstatic
</code></pre>

<p>The static files will then be placed in a directory called static within your project directory.</p>
<h4 id="connect-your-django-app-to-mysql">Connect your Django app to MySQL</h4>
<p>Navigate to the settings.py file and replace the current DATABASES lines with the following. We will configure your database dictionary so that it knows to use MySQL as your database backend and from what file to read your database connection credentials:</p>
<pre><code class="python"># Database
# https://docs.djangoproject.com/en/2.0/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'OPTIONS': {
            'read_default_file': '/etc/mysql/my.cnf',
        },
    }
}
</code></pre>

<p>Next, let’s edit the config file so that it has your MySQL credentials. Use nano as sudo to edit the file and add the following information:</p>
<pre><code>$ sudo nano /etc/mysql/my.cnf
</code></pre>

<pre><code>[client]
database = db_name
user = db_user
password = db_password
default-character-set = utf8
</code></pre>

<p>Where database name in our case is mysite, your username for the MySQL server is the one you’ve created, and the password is the MySQL server password you’ve created. Also, you’ll notice that utf8 is set as the default encoding, this is a common way to encode unicode data in MySQL. Once the file has been edited, we need to restart MySQL for the changes to take effect.</p>
<pre><code>$ systemctl daemon-reload
$ systemctl restart mysql
</code></pre>

<p>Please note that restarting MySQL takes a few seconds, so please be patient. Now, let's test the MySQL connection to the application. We need to verify that the configurations in Django detect your MySQL server properly. We can do this by simply running the server. If it fails, it means that the connection isn’t working properly. Otherwise, the connection is valid.</p>
<pre><code>$ cd ~/mysite/mysite/
$ python manage.py runserver your-server-ip:8000
</code></pre>

<h2 id="6-setting-up-gunicorns-ability-to-serve-the-project">6) Setting up Gunicorn's ability to serve the project</h2>
<p>The last thing we want to do before leaving our virtual environment is test Gunicorn to make sure that it can serve the application. We can do this by entering our project directory and using gunicorn to load the project's WSGI module:</p>
<pre><code>$ cd ~/myproject
$ gunicorn --bind 0.0.0.0:8000 myproject.wsgi
</code></pre>

<p>This will start Gunicorn on the same interface that the Django development server was running on. You can go back and test the app again. </p>
<p>We passed Gunicorn a module by specifying the relative directory path to Django's wsgi.py file, which is the entry point to our application, using Python's module syntax. Inside of this file, a function called application is defined, which is used to communicate with the application. When you are finished testing, hit CTRL-C in the terminal window to stop Gunicorn. We're now finished configuring our Django application. We can back out of our virtual environment by typing:</p>
<pre><code>$ deactivate
</code></pre>

<p>Create and open a systemd service file for Gunicorn with sudo privileges in your text editor:</p>
<pre><code>$ sudo nano /etc/systemd/system/gunicorn.service
</code></pre>

<pre><code>[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=synergix
Group=www-data
WorkingDirectory=/home/synergix/myproject
ExecStart=/home/synergix/myproject/myprojectenv/bin/gunicorn --access-logfile - --workers 3 --bind unix:/home/synergix/myproject/myproject.sock myproject.wsgi:application

[Install]
WantedBy=multi-user.target
</code></pre>

<p>We can now start the Gunicorn service we created and enable it so that it starts at boot:</p>
<pre><code>$ sudo systemctl start gunicorn
$ sudo systemctl enable gunicorn
</code></pre>

<p>We can confirm that the operation was successful by checking for the socket file.</p>
<pre><code>$ sudo systemctl status gunicorn
</code></pre>

<p>Next, check for the existence of the myproject.sock file within your project directory:</p>
<pre><code>$ ls /home/synergix/myproject
</code></pre>

<p>If the systemctl status command indicated that an error occurred or if you do not find the myproject.sock file in the directory, it's an indication that Gunicorn was not able to start correctly. Check the Gunicorn process logs by typing:</p>
<pre><code>$ sudo journalctl -u gunicorn
</code></pre>

<h2 id="7-configure-nginx-to-proxy-pass-to-gunicorn">7) Configure Nginx to Proxy Pass to Gunicorn</h2>
<p>Now that Gunicorn is set up, we need to configure Nginx to pass traffic to the process. Start by creating and opening a new server block in Nginx's sites-available directory:</p>
<pre><code>$ sudo nano /etc/nginx/sites-available/myproject
</code></pre>

<p>Inside, open up a new server block. We will start by specifying that this block should listen on the normal port 80 and that it should respond to our server's domain name or IP address. Next, we will tell Nginx to ignore any problems with finding a favicon. We will also tell it where to find the static assets that we collected in our ~/myproject/static directory. All of these files have a standard URI prefix of "/static", so we can create a location block to match those requests. Finally, we'll create a location / {} block to match all other requests. Inside of this location, we'll include the standard proxy_params file included with the Nginx installation and then we will pass the traffic to the socket that our Gunicorn process created:</p>
<pre><code>server {
    listen 80;
    server_name server_domain_or_IP;

    location = /favicon.ico { access_log off; log_not_found off; }
    location /static/ {
        root /home/sammy/myproject;
    }

    location / {
        include proxy_params;
        proxy_pass http://unix:/home/sammy/myproject/myproject.sock;
    }
}
</code></pre>

<p>Save and close the file when you are finished. Now, we can enable the file by linking it to the sites-enabled directory:</p>
<pre><code>$ sudo ln -s /etc/nginx/sites-available/myproject /etc/nginx/sites-enabled
</code></pre>

<p>Test your Nginx configuration for syntax errors by typing:</p>
<pre><code>$ sudo nginx -t
</code></pre>

<p>If no errors are reported, go ahead and restart Nginx by typing:</p>
<pre><code>$ sudo systemctl restart nginx
</code></pre>

<p>Finally, we need to open up our firewall to normal traffic on port 80. Since we no longer need access to the development server, we can remove the rule to open port 8000 as well:</p>
<pre><code>$ sudo ufw delete allow 8000
$ sudo ufw allow 'Nginx Full'
</code></pre>

<p>You should now be able to go to your server's domain or IP address to view your application.</p>
<h2 id="8-troubleshooting">8) Troubleshooting</h2>
<p>Logs can help narrow down root causes. Check each of them in turn and look for messages indicating problem areas. The following logs may be helpful:</p>
<ul>
<li>Check the Nginx process logs by typing: <code>sudo journalctl -u nginx</code></li>
<li>Check the Nginx access logs by typing: <code>sudo less /var/log/nginx/access.log</code></li>
<li>Check the Nginx error logs by typing: <code>sudo less /var/log/nginx/error.log</code></li>
<li>Check the Gunicorn application logs by typing: <code>sudo journalctl -u gunicorn</code></li>
</ul>
<p>As you update your configuration or application, you will likely need to restart the processes to adjust to your changes. If you update your Django application, you can restart the Gunicorn process to pick up the changes by typing:</p>
<pre><code>$ sudo systemctl restart gunicorn
</code></pre>

<p>If you change gunicorn systemd service file, reload the daemon and restart the process by typing:</p>
<pre><code>$ sudo systemctl daemon-reload
$ sudo systemctl restart gunicorn
</code></pre>

<p>If you change the Nginx server block configuration, test the configuration and then Nginx by typing:</p>
<pre><code>$ sudo nginx -t &amp;&amp; sudo systemctl restart nginx
</code></pre>

<h2 id="references">References</h2>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-ubuntu-16-04">DigitalOcean - Setup Django, Postgres, nginx and Gunicorn on Ubuntu</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-serve-django-applications-with-uwsgi-and-nginx-on-ubuntu-16-04">DigitalOcean - Serve Django with uwsgi and ngix on Ubuntu</a></li>
<li><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-django-app-and-connect-it-to-a-database">DigitalOcean - Create Django app and connect to database</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../crontab/" title="Linux Crontab" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Linux Crontab
              </span>
            </div>
          </a>
        
        
          <a href="../dev-environments/" title="Dev environments" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Dev environments
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a59e2a89.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>